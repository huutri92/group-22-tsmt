@using Microsoft.Ajax.Utilities
@using TSMT.Models
@model IEnumerable<Lodge>
@{
    ViewBag.Title = "ManualAssign";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>ManualAssign</h2>
<select id="capaRoomA" style="display: none">
    <option>Chọn phòng</option>
</select>
<select id="capaRoomB" style="display: none">
    <option>Chọn phòng</option>
</select>
<select id="cbbCandidateGender" onchange="" multiple="multiple" size="5" style="width: 275px; height: 250px;display: none">
</select>
<script>
    function callAjax(id, cbbId, cbbRoomA, cbbRoomB) {
        //if (document.getElementById(cbbRoomA).selectedIndex != 0 && document.getElementById(cbbRoomA).selectedIndex != 0 && document.getElementById(cbbRoomA).selectedIndex == document.getElementById(cbbRoomB).selectedIndex) {
        //    alert("Phòng này đã được chọn, hãy chọn phòng khác");
        //    document.getElementById(cbbRoomA).selectedIndex = 0;
        //} else 
        {
            var lodgeId = document.getElementById("cbbLodge").value;
            $.ajax({
                url: '/Charity/ResultAjaxRoom',
                data: { "id": id, "lodgeId": lodgeId },
                type: 'POST',
                success: function (results) {
                    $("#" + cbbId).html("");
                    var r;
                    for (i in results) {
                        r = results[i];
                        $("#" + cbbId).append("<option value=\"" + r.value + "\">" + r["name"] + "</option>");
                    }
                }
            });
        }
    }

    function callAjaxLodge(id, cbbRoomA, cbbRoomB, capA, capB) {
        $("#cbbCandidate").html("");
        $("#cbbCandidateGender").html("");
        $("#listboxCandidate2").html("");
        $("#listboxCandidate1").html("");
        document.getElementById("cbbRoomLeft").selectedIndex = 0;
        if (document.getElementById("cbbLodge").selectedIndex == 0) {
            $("#cbbCandidate").html("");
        } else {
            $.ajax({
                url: '/Charity/ResultAjaxLodgeCandidate',
                data: { "id": id },
                type: 'POST',
                success: function (results) {
                    $("#cbbCandidate").html("");
                    var r;
                    for (i in results) {
                        r = results[i];
                        $("#cbbCandidate").append("<option value=\"" + r.value + "\">" + r["name"] + "</option>");
                        $("#cbbCandidateGender").append("<option value=\"" + r.value + "\">" + r.gender + "</option>");
                    }
                }
            });
            $.ajax({
                url: '/Charity/ResultAjaxLodgeRoom',
                data: { "id": id },
                type: 'POST',
                success: function (results) {
                    $("#" + cbbRoomA).html("");
                    $("#" + cbbRoomB).html("");
                    $("#" + capA).html("");
                    $("#" + capB).html("");
                    var r;
                    $("#" + cbbRoomA).append("<option value=\"" + 0 + "\">" + "Chọn phòng" + "</option>");
                    $("#" + cbbRoomB).append("<option value=\"" + 0 + "\">" + "Chọn phòng" + "</option>");
                    $("#" + capA).append("<option value=\"" + 0 + "\">" + "Chọn phòng" + "</option>");
                    $("#" + capB).append("<option value=\"" + 0 + "\">" + "Chọn phòng" + "</option>");
                    for (i in results) {
                        r = results[i];
                        $("#" + cbbRoomA).append("<option value=\"" + r.value + "\">" + r["name"] + "</option>");
                        $("#" + cbbRoomB).append("<option value=\"" + r.value + "\">" + r["name"] + "</option>");
                        $("#" + capA).append("<option value=\"" + r.capacity + "\">" + r.gender + "</option>");
                        $("#" + capB).append("<option value=\"" + r.capacity + "\">" + r.gender + "</option>");
                    }
                }
            });
        }
    }



    function AddRemoveA(fromSourceId, toSourceId, capacity) {
        var capcity = parseInt($("#" + capacity).val());
        var genderCan = document.getElementById("cbbCandidateGender").selectedOptions.value;
        var genderRoom = document.getElementById("capaRoomA").selectedText;
        if (genderCan == genderRoom && genderRoom == "false") {
            alert("Không thể xếp thí sinh nam vào phòng nữ");
        } else if (genderCan == genderRoom && genderRoom == "True") {
            alert("Không thể xếp thí sinh nữ vào phòng nam");
        } else
            if ($('#' + fromSourceId + ' :selected').length <= capcity) {
                var srcFrom = $("#" + fromSourceId)[0];
                var srcTo = $("#" + toSourceId)[0];
                $('#' + fromSourceId + ' :selected').each(function (i, item) {
                    srcTo.appendChild(item);
                });
            } else {
                alert("Số thí sinh phải nhỏ hơn tiêu chuẩn phòng");
            }
    }
    function AddRemoveB(fromSourceId, toSourceId) {
        var srcFrom = $("#" + fromSourceId)[0];
        var srcTo = $("#" + toSourceId)[0];
        $('#' + fromSourceId + ' :selected').each(function (i, item) {
            srcTo.appendChild(item);
        });
    }



    function saveListCandidate() {

        var listRoomA = document.getElementById("listboxCandidate1");
        var listCandidate = document.getElementById("cbbCandidate");
        var caId;
        var roomId = $("#cbbRoomLeft").val();
        if (listCandidate.length != 0) {
            for (var c = 0; c < listCandidate.length; c++) {
                caId = listCandidate[c].value;
                roomId = 0;
                $.ajax({
                    url: '/Charity/EditAssignRoom',
                    data: { "caId": caId, "roomId": roomId },
                    type: 'Post',
                });
            }
        }
        if (listCandidate.length != 0 && listRoomA.length != 0) {

            for (var i = 0; i < listRoomA.length; i++) {
                caId = document.getElementById("listboxCandidate1")[i].value;
                $.ajax({
                    url: '/Charity/EditAssignRoom',
                    data: { "caId": caId, "roomId": roomId },
                    type: 'Post',
                });
            }

            for (var x = 0; x < listCandidate.length; x++) {
                caId = document.getElementById("cbbCandidate")[x].value;
                $.ajax({
                    url: '/Charity/EditAssignRoom',
                    data: { "caId": caId, "roomId": roomId },
                    type: 'Post',
                });
            }
        }

        if (listRoomA.length == 0) {
            for (var a = 0; a < listCandidate.length; a++) {
                caId = document.getElementById("cbbCandidate")[a].value;
                $.ajax({
                    url: '/Charity/EditAssignRoom',
                    data: { "caId": caId, "roomId": roomId },
                    type: 'Post',
                });
            }
        }
        if (listCandidate.length == 0) {
            for (var b = 0; b < listRoomA.length; b++) {
                caId = document.getElementById("listboxCandidate1")[b].value;
                $.ajax({
                    url: '/Charity/EditAssignRoom',
                    data: { "caId": caId, "roomId": roomId },
                    type: 'Post',
                });
            }
        }
        alert("Lưu thành công");
    }


    function syncChange(id) {
        if (document.getElementById("cbbRoomLeft").selectedIndex == 0) {
            $('#listboxCandidate1').empty();
        }
        //if (document.getElementById("cbbRoomRight").selectedIndex == 0) {
        //    $('#listboxCandidate2').empty();
        //}
        var selected = document.getElementById(id).selectedIndex;
        var select1 = document.getElementById("capaRoomA");
        var select3 = document.getElementById("cbbCandidateGender");
        if (id == "cbbRoomLeft") {
            for (var i = 0; i < select1.options.length; i++) {
                if (select1.options[i].index == selected) {
                    select1.options[i].selected = true;
                }
            }
        } else {
            if ($('#' + id + ' :selected').length > 1) {
                $('#cbbCandidateGender :selected');
                for (var z = 0; z < select3.options.length; z++) {
                    if (select3.options[z].index == selected) {
                        select3.options[z].selected = true;
                    }
                }
            } else {
                $('#cbbCandidateGender').prop('selectedIndex', -1);
                for (var j = 0; j < select3.options.length; j++) {
                    if (select3.options[j].index == selected) {
                        select3.options[j].selected = true;
                    }
                }
            }
            
        }

    }
</script>

<div class="col-md-9">
    <select id="cbbLodge" onchange=" callAjaxLodge(this.value,'cbbRoomLeft','cbbRoomRight','capaRoomA','capaRoomB')">
        <option id="index0">Chọn điểm trọ</option>
        @foreach (var item in Model)
        {
            <option value="@item.LodgeID">@item.Address</option>
        }
    </select>

    <div class="row margin-bottom-10">
        <div class="col-md-5">
            <label>Thí sinh chưa xếp phòng</label>
            <select id="cbbCandidate" onchange="syncChange('cbbCandidate')" multiple="multiple" size="5" style="width: 275px; height: 250px">
            <option ></option>
            </select>
        </div>
        <div class="col-md-2">
            <div style="padding-bottom: 15px; padding-top: 70px">
                <input type="button" id="btnB" onclick="AddRemoveA('cbbCandidate', 'listboxCandidate1', 'capaRoomA');" value=">>>>>" />
            </div>
            <div style="padding-bottom: 15px">
                <input type="button" id="btnA" onclick="AddRemoveB('listboxCandidate1', 'cbbCandidate');" value="<<<<<" />
            </div>
            @*  <div style="padding-bottom: 15px; padding-top: 200px">
                <input type="button" id="btnE" onclick="AddRemoveB('listboxCandidate2', 'cbbCandidate');" value="<<<<<" />
            </div>
            <div style="padding-bottom: 15px">
                <input type="button" id="btnF" onclick="AddRemoveA('cbbCandidate', 'listboxCandidate2', 'capaRoomB');" value=">>>>>" />
            </div>*@
        </div>
        <div class="col-md-5">
            <div class="view view-tenth">
                <select id="cbbRoomLeft" onchange=" callAjax(this.value, 'listboxCandidate1','cbbRoomLeft','cbbRoomRight'),syncChange('cbbRoomLeft')">
                    <option id="index1" value="0">Chọn phòng</option>
                </select>
                <select id="listboxCandidate1" multiple="multiple" size="5" style="width: 275px; height: 250px">
                </select>
            </div>
            @*<div style="padding-bottom: 15px; padding-top: 70px">
                <input type="button" id="btnC" onclick="AddRemoveA('listboxCandidate2', 'listboxCandidate1', 'capaRoomA');" value="Lên" />
                <input type="button" id="btnD" onclick="AddRemoveA('listboxCandidate1', 'listboxCandidate2', 'capaRoomB');" value="Xuống" />
            </div>
            <div class="view view-tenth">
                <select id="cbbRoomRight" onchange=" callAjax(this.value, 'listboxCandidate2','cbbRoomRight','cbbRoomLeft'),syncChange('cbbRoomRight') ">
                    <option id="index2" value="0">Chọn phòng</option>
                </select>
                <select id="listboxCandidate2" multiple="multiple" size="5" style="width: 300px; height: 180px">
                </select>
            </div>*@
        </div>
    </div>


    <input type="submit" value="Lưu lại" class="btn-info" onclick=" saveListCandidate()" />


</div>


@*<div class="col-md-1" style="padding-left: 36px">
    <div style="padding-bottom: 15px; padding-top: 70px">
        <input type="button" id="btnB" onclick="AddRemoveA('cbbCandidate', 'listboxCandidate1', 'capaRoomA');" value=">>>>>" />
    </div>
    <div style="padding-bottom: 15px">
        <input type="button" id="btnA" onclick="AddRemoveB('listboxCandidate1', 'cbbCandidate');" value="<<<<<" />
    </div>
    <div style="padding-bottom: 15px; padding-top: 200px">
        <input type="button" id="btnE" onclick="AddRemoveB('listboxCandidate2', 'cbbCandidate');" value="<<<<<" />
    </div>
    <div style="padding-bottom: 15px">
        <input type="button" id="btnF" onclick="AddRemoveA('cbbCandidate', 'listboxCandidate2', 'capaRoomB');" value=">>>>>" />
    </div>
</div>*@

@*<div class="col-md-3">
    <div class="view view-tenth">
        <select id="cbbRoomLeft" onchange=" callAjax(this.value, 'listboxCandidate1','cbbRoomLeft','cbbRoomRight'),syncChange('cbbRoomLeft')">
            <option id="index1" value="0">Chọn phòng</option>
        </select>
        <select id="listboxCandidate1" multiple="multiple" size="5" style="width: 300px; height: 180px">
        </select>
    </div>
    <div style="padding-bottom: 15px; padding-top: 70px">
        <input type="button" id="btnC" onclick="AddRemoveA('listboxCandidate2', 'listboxCandidate1', 'capaRoomA');" value="Lên" />
        <input type="button" id="btnD" onclick="AddRemoveA('listboxCandidate1', 'listboxCandidate2', 'capaRoomB');" value="Xuống" />
    </div>
    <div class="view view-tenth">
        <select id="cbbRoomRight" onchange=" callAjax(this.value, 'listboxCandidate2','cbbRoomRight','cbbRoomLeft'),syncChange('cbbRoomRight') ">
            <option id="index2" value="0">Chọn phòng</option>
        </select>
        <select id="listboxCandidate2" multiple="multiple" size="5" style="width: 300px; height: 180px">
        </select>
    </div>
</div>
*@

@*<div class="col-md-1" style="padding-left: 36px">
</div>
<div class="col-md-3 col-sm-6">
</div>*@


