<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Apply Permutations</title>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
		var directionsDisplay = new google.maps.DirectionsRenderer();
		var directionsService = new google.maps.DirectionsService();

		var dataWayPoints = [
			'03 hoa binh, quan 11',
			'100 quang trung, quan 12',
			'cong truong me linh',
			'12 nguyen van bao, quan go vap'
		]

		var allwaypoints = [];
		var minD = 999;
		var numbering = 0;
		  
		function initialize() {
		  var s = '';
		  var d = 0;
		  for (var i = 0; i < dataWayPoints.length; ++i){
			s += ++d + '. ' + dataWayPoints[i] + '<br>';
		  }
		  
		  document.getElementById("waypoints").innerHTML = s;
		  
		  createInput();
		  genRoute();
		}

		function createInput(){
			for (var i = 0; i < dataWayPoints.length; ++i){
				var tmp = {
					index: i,
					data: dataWayPoints[i]
				}
				allwaypoints.push(tmp);
			}
		}

		function genRoute() {
			var n = allwaypoints.length;
			var i = n - 1;
			while (i > 0){
				var request = {
					origin: allwaypoints[0].data,
					destination: allwaypoints[1].data,
					waypoints:[{location: allwaypoints[2].data}, {location: allwaypoints[3].data}],
					travelMode: google.maps.TravelMode.DRIVING
				};
				
				var s = "";
				for (i = 0; i < n; ++i)
					s += " " + allwaypoints[i].data;
				console.log(s);
				
				directionsService.route(request, function(response, status) {
					if (status == google.maps.DirectionsStatus.OK) {
						directionsDisplay.setDirections(response);
						computeTotalDistance(response);
					}
				});
				
				i = n - 2;
				while ((i > -1) && (allwaypoints[i].index > allwaypoints[i + 1].index)) --i;
				if (i > -1){
					var k = n - 1;
					while (allwaypoints[k].index < allwaypoints[i].index) --k;
					swap(k, i);
					var x = i + 1;
					var y = n - 1;
					while (x < y){
						swap(x, y);
						++x;
						--y;
					}
				}
			}
		}

		function swap(i, j){
			var tmp = allwaypoints[i];
			allwaypoints[i] = allwaypoints[j];
			allwaypoints[j] = tmp;
		}

		function computeTotalDistance(result) {
		  var total = 0;
		  var myroute = result.routes[0];
		  for (var i = 0; i < myroute.legs.length; i++) {
			total += myroute.legs[i].distance.value;
		  }
		  total = total / 1000.0;
		  
		  if (total < minD){
			minD = total;
			var s = '';
			for (var i = 0; i < myroute.legs.length; ++i){
				s += i+1 + ' -- ' + myroute.legs[i].start_address + '<br>';
			}
			s += myroute.legs.length+1 + ' -- ' + myroute.legs[myroute.legs.length-1].end_address;
			s += '<br> ===> ' + minD + ' kms';
			document.getElementById('result').innerHTML = s;
		  }
		  
		  document.getElementById('total').innerHTML +=  ++numbering + ' -- ' + total + ' kms <br>';
		}
		
		google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="directionsPanel" style="margin-left:20px;">
		<h3>Way points</h3><span id="waypoints"></span>
		<h3>Distances by permutations</h3><span id="total"></span>
		<h3>Best way</h3><span id="result"></span>
    </div>
  </body>
</html>