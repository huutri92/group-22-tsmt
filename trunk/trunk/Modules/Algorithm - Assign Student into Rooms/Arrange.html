<!DOCTYPE html>
<html>
  <head>
    <title>Students to Rooms</title>
	<script src="Class.js"></script>
	<script src="SinhVien.js"></script>
	<script src="Nhom.js"></script>
	<script src="Phong.js"></script>
	<script>
		function arrangement(){
			var logging = '';
			
			logging += '<br>' +  "LEVEL 1 - Lay danh sach";
			var sv = [];
			sv.push(new sinhvien("M01", true, 2));
			sv.push(new sinhvien("M04", true, 2));
			sv.push(new sinhvien("F01", false, 3));
			sv.push(new sinhvien("F02", false, 1));
			sv.push(new sinhvien("F03", false, 3));
			sv.push(new sinhvien("F03", false, 1));
			sv.push(new sinhvien("M02", true, 4));
			sv.push(new sinhvien("M03", true, 4));
			sv.push(new sinhvien("F04", false, 1));
			sv.push(new sinhvien("F05", false, 1));
			sv.push(new sinhvien("M04", true, 5));
			sv.push(new sinhvien("F06", false, 3));
			sv.push(new sinhvien("M05", true, 5));
			sv.push(new sinhvien("M06", true, 4));
			sv.push(new sinhvien("F07", false, 6));
			sv.push(new sinhvien("F09", false, 7));
			sv.push(new sinhvien("F08", false, 6));

			for (var i = 0; i < sv.length; ++i){
				logging += '<br>' + sv[i].getDisplay();
			}
			logging += '<br>' +  "END STEP 1";
			
			logging += '<br>' +  "STEP 2 - Tach nu ra";
			var Fsv = [];
			for (var i = 0; i < sv.length; ++i){
				if (!sv[i].getGioiTinh()){
					Fsv.push(sv[i]);
				}
			}
			
			for (var i = 0; i < Fsv.length; ++i){
				logging += '<br>' +  Fsv[i].getDisplay();
			}
			logging += '<br>' +  "END STEP 2";
			
			logging += '<br>' +  "STEP 3 - Gom nhom";
			
			// Ladies only
			var DSNhomNu = []; // danh sach cac "nhom" nu
			
			for (var i = 0; i < Fsv.length; ++i){
				var groupOrder = getGroupOrder(DSNhomNu, Fsv[i].getTenNhom());
				if (groupOrder < 0){ // nhom chua duoc tao
					DSNhomNu.push(new nhom(Fsv[i].getTenNhom())); // tao nhom moi
					groupOrder = DSNhomNu.length-1;
				}
				DSNhomNu[groupOrder].getDanhSachSV().push(Fsv[i]);
			}
			
			for (var i = 0; i < DSNhomNu.length; ++i){
				for (var j = 0; j < DSNhomNu[i].getDanhSachSV().length; ++j){
					logging += '<br>' +  DSNhomNu[i].getDanhSachSV()[j].getDisplay();
				}
			}
			
			logging += '<br>' +  "END STEP 3";
			
			logging += '<br>' +  "STEP 4 - Sap xep nhom theo so luong giam dan";
			// Ladies only
			for (var i = 0; i < DSNhomNu.length-1; ++i){
				for (var j = i+1; j < DSNhomNu.length; ++j){
					if (DSNhomNu[i].getDanhSachSV().length < DSNhomNu[j].getDanhSachSV().length){
						var tmp = DSNhomNu[i];
						DSNhomNu[i] = DSNhomNu[j];
						DSNhomNu[j] = tmp;
					}
				}
			}
			
			for (var i = 0; i < DSNhomNu.length; ++i){
				for (var j = 0; j < DSNhomNu[i].getDanhSachSV().length; ++j){
					logging += '<br>' +  DSNhomNu[i].getDanhSachSV()[j].getDisplay();
				}
			}
			
			logging += '<br>' +  "END STEP 4";
			
			logging += '<br>' +  "STEP 5 - Danh sach phong tro";
			var rooms = [];
			rooms.push(new phong("P1", 2));
			rooms.push(new phong("P2", 4));
			rooms.push(new phong("P3", 3));
			rooms.push(new phong("P4", 2));
			for (var i = 0; i < rooms.length; ++i){
				logging += '<br>' +  rooms[i].getTenPhong() + " --- " + rooms[i].getSoLuong();
			}
			logging += '<br>' +  "END STEP 5";
			
			logging += '<br>' +  "STEP 6 - Sap sinh vien vao phong tro";
			// Ladies only 	
			for (var i = 0; i < DSNhomNu.length; ++i){
				var bug = true;
				for (var j = 0; j < rooms.length; ++j){
					if (rooms[j].getSoLuongConTrong() >= DSNhomNu[i].getDanhSachSV().length){
						if (rooms[j].getGioiTinh() == null){
							rooms[j].setGioiTinh(false);
						}
						if (rooms[j].getGioiTinh() == false){
							DSNhomNu[i].setTenPhong(rooms[j].getTenPhong());
							rooms[j].setSoLuongConTrong(rooms[j].getSoLuongConTrong() - DSNhomNu[i].getDanhSachSV().length);
							logging += '<br>' +  "Xep nhom " + DSNhomNu[i].getTenNhom() + " vao phong " + rooms[j].getTenPhong();
							bug = false;
							break;
						}
					}
				}
				
				if (bug){
					logging += '<br>' +  "Khong the xep nhom " + DSNhomNu[i].getTenNhom();
				}
			}
			
			for (var i = 0; i < DSNhomNu.length; ++i){
				logging += '<br>' +  DSNhomNu[i].getTenNhom() + " --- " + DSNhomNu[i].getTenPhong();
			}
			logging += '<br>' +  "END STEP 6";
			
			document.getElementById('logging').innerHTML = logging;
		}
		
		function getGroupOrder(groups, name){
			for (var i = 0; i < groups.length; ++i){
				if (groups[i].tennhom == name) return i;
			}
			return -1;
		}
    </script>    
  </head>
  <body>
	<button onclick='arrangement()'>Launch!</button>
	<div id='logging'></div>
  </body>
</html>